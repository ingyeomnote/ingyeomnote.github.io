**서버프로그램에서 사용자의 게시판 글 등록 서비스를 구현하시오.**

**(처리결과 성공시에는 게시글 목록을 출력하는 blist 서블릿을 실행하고, 실패시에는 content directory/views/common/error.jsp 를 view 페이지로 지정하고 "message" 키로 "게시글 등록 실패!" 메세지를 포워딩 하시오.**



**데이터베이스의 board테이블 생성 스크립트는 다음과 같다.**



CREATE TABLE BOARD(

BOARD_NUM NUMBER,

BOARD_WRITER VARCHAR2(20) NOT NULL,

BOARD_TITLE VARCHAR2(50) NOT NULL,

BOARD_CONTENT VARCHAR2(2000) NOT NULL,

BOARD_DATE DATE DEFAULT SYSDATE,

CONSTRAINT PK_BOARD PRIMARY KEY (BOARD_NUM),

CONSTRAINT FK_BOARD_WRITER FOREIGN KEY (BOARD_WRITER) REFERENCES MEMBER (USERID) ON DELETE SET NULL

);



COMMENT ON COLUMN BOARD.BOARD_NUM IS '게시글번호';

COMMENT ON COLUMN BOARD.BOARD_WRITER IS '작성자아이디';

COMMENT ON COLUMN BOARD.BOARD_TITLE IS '게시글제목';

COMMENT ON COLUMN BOARD.BOARD_CONTENT IS '게시글내용';

COMMENT ON COLUMN BOARD.BOARD_DATE IS '작성날짜';



사용자에게 제공할 게시판 등록 폼페이지는 다음과 같다.

<form action="<%= request.getContextPath() %>/binsert" method="post">

<table align="center">

<tr><td>제목</td>

<td><input type="text" name="btitle"></td></tr>

<tr><td>작성자</td>

<td><input type="text" readonly name="bwriter"

value="<%= loginUser.getUserId() %>"></td></tr>

<tr><td>내용</td>

<td><textarea cols="50" rows="7" name="bcontent"></textarea></td></tr>

<tr><td colspan="2" align="center">

<input type="submit" value="등록하기">  

<a href="/first/blist?page=1">목록으로</a></td></tr>

</table>

</form>



**게시글 등록 서블릿 클래스의 doPost()와 doGet() 메소드 안의 코드를 작성하시오.**



protected void doGet(HttpServletRequest request, HttpServletResponse response)

throws ServletException, IOException {

// 게시글 원글 등록 처리용 컨트롤러

//request.setCharacterEncoding("utf-8");



Board b = new Board();

b.setBoardTitle(request.getParameter("btitle"));

b.setBoardContent(request.getParameter("bcontent"));

b.setBoardWriter(request.getParameter("bwriter"));



if (new BoardService().insertBoard(b) > 0) {

response.sendRedirect("/first/blist?page=1");

} else {

view = request.getRequestDispatcher("views/board/boardError.jsp");

request.setAttribute("message", "게시 원글 등록 서비스 실패!");

view.forward(request, response);

}

}



/**

\* @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse

\* response)

*/

protected void doPost(HttpServletRequest request, HttpServletResponse response)

throws ServletException, IOException {

// TODO Auto-generated method stub

doGet(request, response);

}





**BoardDao.java 클래스의 insertBoard(conn, board) 메소드를 PreparedStatement 로 새 게시글 등록 처리가 되도록 구현하시오.**



public int insertBoard(Connection con, Board b) {

int result = 0;

PreparedStatement pstmt = null;



String query = "insert into board values "

\+ "((select max(board_num) + 1 from board), "

\+ "?, ?, ?, default)";



try {

pstmt = con.prepareStatement(query);

pstmt.setString(1, b.getBoardWriter());

pstmt.setString(2, b.getBoardTitle());

pstmt.setString(3, b.getBoardContent());



result = pstmt.executeUpdate();



} catch (Exception e) {

e.printStackTrace();

} finally {

close(pstmt);

}



return result;

}



**공통모듈인 JDBCTemplate.java 의 getConnect() 을 사용하여 Connection 을 생성하고, BoardDao 클래스의 insertBoard() 로 Connection 과 전달받은 Board 객체 정보를 전달하고 나서 처리결과를 리턴받아 트랜잭션을 처리하고 Connection 을 close 하고 받은 결과를 컨트롤러로 리턴한다.**

public int insertBoard(Board b) {

Connection con = getConnection();

int result = new BoardDao().insertBoard(con, b);

if(result > 0)

commit(con);

else

rollback(con);

close(con);

return result;

}



